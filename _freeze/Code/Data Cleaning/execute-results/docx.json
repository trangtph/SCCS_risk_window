{
  "hash": "296a97ca108f98602773f6ce06b8faa8",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Project SCCS Risk Window Scanning\"\nsubtitle: \"Data Cleaning\"\nauthor: \"Trang Tu - Albert Chuang\"\nformat: \n  docx:\n    documentclass: report\n    margin-left: 20 mm\n    margin-right: 20 mm\n    margin-top: 20 mm\n    margin-bottom: 20 mm\n    fig-align: center\n    fig-width: 2.5\n    fig-height: 3\nexecute: \n  echo: false\n  warning: true\n  message: true\n  output: true\n  freeze: auto\neditor: visual\n---\n\n::: {.cell}\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'dplyr'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nhere() starts at /Users/tranghien/Library/CloudStorage/OneDrive-UniversiteitUtrecht/My_PhD/Research/4_SCCS_Focal_Window/Analysis/SCCS_risk_window\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'lubridate'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:base':\n\n    date, intersect, setdiff, union\n```\n\n\n:::\n:::\n\n\n\n## Load the tables of the CDM\n\n<!-- Note: Please change the file names (and file location if needed) corresponding to the actual files in the computer -->\n\n\n\n::: {.cell}\n\n:::\n\n\n\n## 0. Data cleaning\n\n-   Skim the initial structure of the data:\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n$individual\n      ID             birth_date        birth_month         birth_year       \n Length:335         Length:335         Length:335         Length:335        \n Class :character   Class :character   Class :character   Class :character  \n Mode  :character   Mode  :character   Mode  :character   Mode  :character  \n     sex             death_date         enrol_date        deregister_date   \n Length:335         Length:335         Length:335         Length:335        \n Class :character   Class :character   Class :character   Class :character  \n Mode  :character   Mode  :character   Mode  :character   Mode  :character  \n\n$covid_infection\n      id             infect_date        \n Length:100         Min.   :2020-01-22  \n Class :character   1st Qu.:2020-10-23  \n Mode  :character   Median :2021-06-14  \n                    Mean   :2021-06-19  \n                    3rd Qu.:2022-02-13  \n                    Max.   :2022-12-20  \n\n$covid_vacc\n      id             vacc_date_1          vacc_brand_1   vacc_date_2        \n Length:301         Min.   :2020-01-04   Min.   :1.00   Min.   :2020-03-10  \n Class :character   1st Qu.:2020-10-26   1st Qu.:1.00   1st Qu.:2021-12-01  \n Mode  :character   Median :2021-07-27   Median :2.00   Median :2022-07-05  \n                    Mean   :2021-07-11   Mean   :1.97   Mean   :2022-04-15  \n                    3rd Qu.:2022-03-24   3rd Qu.:3.00   3rd Qu.:2022-10-26  \n                    Max.   :2022-12-19   Max.   :3.00   Max.   :2022-12-31  \n                                                        NA's   :54          \n  vacc_brand_2   vacc_date_3          vacc_brand_3  \n Min.   :1.00   Min.   :2020-12-15   Min.   :1.000  \n 1st Qu.:1.00   1st Qu.:2022-06-06   1st Qu.:1.000  \n Median :2.00   Median :2022-10-18   Median :2.000  \n Mean   :1.98   Mean   :2022-08-11   Mean   :2.031  \n 3rd Qu.:3.00   3rd Qu.:2022-12-06   3rd Qu.:3.000  \n Max.   :3.00   Max.   :2022-12-31   Max.   :3.000  \n NA's   :54     NA's   :142          NA's   :142    \n\n$outcome_event\n      ID              HOSP_ID          primary_diagnosis diagnosis_date      \n Length:437         Length:437         Min.   :0.0000    Min.   :2020-01-05  \n Class :character   Class :character   1st Qu.:0.0000    1st Qu.:2020-11-03  \n Mode  :character   Mode  :character   Median :1.0000    Median :2021-07-14  \n                                       Mean   :0.6453    Mean   :2021-07-11  \n                                       3rd Qu.:1.0000    3rd Qu.:2022-03-17  \n                                       Max.   :1.0000    Max.   :2022-12-30  \n diagnosis_code     coding_system      hosp_id_new           id_new         \n Length:437         Length:437         Length:437         Length:437        \n Class :character   Class :character   Class :character   Class :character  \n Mode  :character   Mode  :character   Mode  :character   Mode  :character  \n                                                                            \n                                                                            \n                                                                            \n\n$comorbidity\n      ID            diagnosis_date       diagnosis_code     origin_of_event   \n Length:4478        Min.   :2019-10-01   Length:4478        Length:4478       \n Class :character   1st Qu.:2019-12-31   Class :character   Class :character  \n Mode  :character   Median :2020-04-03   Mode  :character   Mode  :character  \n                    Mean   :2020-03-31                                        \n                    3rd Qu.:2020-07-01                                        \n                    Max.   :2020-09-30                                        \n coding_system     \n Length:4478       \n Class :character  \n Mode  :character  \n                   \n                   \n                   \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nData type, number of empty cells and number of unique values per variable:\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$individual\n                       variable     class n_empty n_unique\nID                           ID character       0      335\nbirth_date           birth_date character       0        1\nbirth_month         birth_month character       0       12\nbirth_year           birth_year character       0       77\nsex                         sex character       0        2\ndeath_date           death_date character       0       78\nenrol_date           enrol_date character     335        1\nderegister_date deregister_date character     255       78\n\n$covid_infection\n               variable     class n_empty n_unique\nid                   id character       0       85\ninfect_date infect_date     IDate       0       99\n\n$covid_vacc\n                 variable     class n_empty n_unique\nid                     id character       0      301\nvacc_date_1   vacc_date_1     IDate       0      263\nvacc_brand_1 vacc_brand_1   integer       0        3\nvacc_date_2   vacc_date_2     IDate       0      201\nvacc_brand_2 vacc_brand_2   integer       0        3\nvacc_date_3   vacc_date_3     IDate       0      116\nvacc_brand_3 vacc_brand_3   integer       0        3\n\n$outcome_event\n                           variable     class n_empty n_unique\nID                               ID character       0      335\nHOSP_ID                     HOSP_ID character      50      101\nprimary_diagnosis primary_diagnosis   integer       0        2\ndiagnosis_date       diagnosis_date     IDate       0      354\ndiagnosis_code       diagnosis_code character       0        8\ncoding_system         coding_system character       0        1\nhosp_id_new             hosp_id_new character      50      101\nid_new                       id_new character      50      336\n\n$comorbidity\n                       variable     class n_empty n_unique\nID                           ID character       0      237\ndiagnosis_date   diagnosis_date     IDate       0      366\ndiagnosis_code   diagnosis_code character       0      101\norigin_of_event origin_of_event character       0        2\ncoding_system     coding_system character       0        1\n```\n\n\n:::\n:::\n\n\n\n- Skim the date format:\n\n<!--- Note: Please look at the output of this chunk to check if the format of all the date columns (except the column `birth_date`), is one of the following: dd/mm/yyyy, dd-mm-yyyy, yyyy-mm-dd, yyyy/mm/dd. If not, please convert them to the above format before continue. --->\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nbirth_date chr [1:335] \"15\" \"15\" \"15\" \"15\" \"15\" \"15\" \"15\" \"15\" \"15\" \"15\" \"15\" \"15\" ...\ndeath_date chr [1:335] \"         .\" \"         .\" \"11/10/2016\" \"15/05/2015\" ...\nenrol_date chr [1:335] \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" \"\" ...\nderegister_date chr [1:335] \"\" \"\" \"11/10/2016\" \"15/05/2015\" \"\" \"\" \"\" \"\" \"\" \"\" \"14/10/2015\" ...\ninfect_date IDate[1:100], format: \"2022-11-20\" \"2021-02-05\" \"2022-09-22\" \"2021-06-26\" \"2022-02-05\" ...\nvacc_date_1 IDate[1:301], format: \"2020-02-17\" \"2022-12-16\" \"2022-02-28\" \"2021-12-05\" \"2021-09-15\" ...\nvacc_date_2 IDate[1:301], format: \"2021-05-26\" NA \"2022-05-19\" \"2022-04-25\" NA \"2022-05-23\" NA ...\nvacc_date_3 IDate[1:301], format: \"2022-02-16\" NA NA \"2022-05-19\" NA \"2022-06-16\" NA \"2022-12-14\" ...\ndiagnosis_date IDate[1:437], format: \"2020-11-04\" \"2020-12-22\" \"2020-06-03\" \"2020-11-04\" \"2020-03-01\" ...\ndiagnosis_date IDate[1:4478], format: \"2020-09-24\" \"2020-05-19\" \"2020-09-05\" \"2020-07-06\" \"2020-07-20\" ...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$individual\nNULL\n\n$covid_infection\nNULL\n\n$covid_vacc\nNULL\n\n$outcome_event\nNULL\n\n$comorbidity\nNULL\n```\n\n\n:::\n:::\n\n\n\n### Format variables\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n\n### Add calculated variables\n\n\n\n::: {.cell}\n\n:::\n\n\n\n### Skim the cleaned datasets\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n$individual\n      id              birth_date  birth_month       birth_year        sex     \n Length:335         Min.   :15   Min.   : 1.000   Min.   :1914   Male   :160  \n Class :character   1st Qu.:15   1st Qu.: 4.000   1st Qu.:1933   Female :175  \n Mode  :character   Median :15   Median : 7.000   Median :1944   Unknown:  0  \n                    Mean   :15   Mean   : 6.487   Mean   :1948                \n                    3rd Qu.:15   3rd Qu.:10.000   3rd Qu.:1960                \n                    Max.   :15   Max.   :12.000   Max.   :1999                \n                                                                              \n   death_date           enrol_date  deregister_date           age        \n Min.   :2015-02-04   Min.   :NA    Min.   :2015-02-04   Min.   : 21.00  \n 1st Qu.:2015-12-08   1st Qu.:NA    1st Qu.:2015-12-08   1st Qu.: 59.50  \n Median :2017-01-03   Median :NA    Median :2017-01-03   Median : 76.00  \n Mean   :2016-12-06   Mean   :NaN   Mean   :2016-12-06   Mean   : 71.79  \n 3rd Qu.:2017-11-12   3rd Qu.:NA    3rd Qu.:2017-11-12   3rd Qu.: 87.00  \n Max.   :2018-11-09   Max.   :NA    Max.   :2018-11-09   Max.   :106.00  \n NA's   :255          NA's   :335   NA's   :255                          \n\n$covid_infection\n      id             infect_date        \n Length:100         Min.   :2020-01-22  \n Class :character   1st Qu.:2020-10-23  \n Mode  :character   Median :2021-06-14  \n                    Mean   :2021-06-19  \n                    3rd Qu.:2022-02-13  \n                    Max.   :2022-12-20  \n\n$covid_vacc\n      id             vacc_date_1          vacc_brand_1   vacc_date_2        \n Length:301         Min.   :2020-01-04   Min.   :1.00   Min.   :2020-03-10  \n Class :character   1st Qu.:2020-10-26   1st Qu.:1.00   1st Qu.:2021-12-01  \n Mode  :character   Median :2021-07-27   Median :2.00   Median :2022-07-05  \n                    Mean   :2021-07-11   Mean   :1.97   Mean   :2022-04-15  \n                    3rd Qu.:2022-03-24   3rd Qu.:3.00   3rd Qu.:2022-10-26  \n                    Max.   :2022-12-19   Max.   :3.00   Max.   :2022-12-31  \n                                                        NA's   :54          \n  vacc_brand_2   vacc_date_3          vacc_brand_3  \n Min.   :1.00   Min.   :2020-12-15   Min.   :1.000  \n 1st Qu.:1.00   1st Qu.:2022-06-06   1st Qu.:1.000  \n Median :2.00   Median :2022-10-18   Median :2.000  \n Mean   :1.98   Mean   :2022-08-11   Mean   :2.031  \n 3rd Qu.:3.00   3rd Qu.:2022-12-06   3rd Qu.:3.000  \n Max.   :3.00   Max.   :2022-12-31   Max.   :3.000  \n NA's   :54     NA's   :142          NA's   :142    \n\n$outcome_event\n      id              hosp_id          primary_diagnosis diagnosis_date      \n Length:437         Length:437         Min.   :0.0000    Min.   :2020-01-05  \n Class :character   Class :character   1st Qu.:0.0000    1st Qu.:2020-11-03  \n Mode  :character   Mode  :character   Median :1.0000    Median :2021-07-14  \n                                       Mean   :0.6453    Mean   :2021-07-11  \n                                       3rd Qu.:1.0000    3rd Qu.:2022-03-17  \n                                       Max.   :1.0000    Max.   :2022-12-30  \n diagnosis_code     coding_system      hosp_id_new           id_new         \n Length:437         Length:437         Length:437         Length:437        \n Class :character   Class :character   Class :character   Class :character  \n Mode  :character   Mode  :character   Mode  :character   Mode  :character  \n                                                                            \n                                                                            \n                                                                            \n\n$comorbidity\n      id            diagnosis_date       diagnosis_code     origin_of_event\n Length:4478        Min.   :2019-10-01   Length:4478        in_pat : 911   \n Class :character   1st Qu.:2019-12-31   Class :character   out_pat:3567   \n Mode  :character   Median :2020-04-03   Mode  :character                  \n                    Mean   :2020-03-31                                     \n                    3rd Qu.:2020-07-01                                     \n                    Max.   :2020-09-30                                     \n coding_system     \n Length:4478       \n Class :character  \n Mode  :character  \n                   \n                   \n                   \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNumber of empty cells and unique values per variable:\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$individual\n                       variable     class n_empty n_unique\nid                           id character       0      335\nbirth_date           birth_date   integer       0        1\nbirth_month         birth_month   integer       0       12\nbirth_year           birth_year   integer       0       77\nsex                         sex    factor       0        2\ndeath_date           death_date      Date       0       77\nenrol_date           enrol_date      Date       0        0\nderegister_date deregister_date      Date       0       77\nage                         age   numeric       0       77\n\n$covid_infection\n               variable     class n_empty n_unique\nid                   id character       0       85\ninfect_date infect_date      Date       0       99\n\n$covid_vacc\n                 variable     class n_empty n_unique\nid                     id character       0      301\nvacc_date_1   vacc_date_1      Date       0      263\nvacc_brand_1 vacc_brand_1   numeric       0        3\nvacc_date_2   vacc_date_2      Date       0      201\nvacc_brand_2 vacc_brand_2   numeric       0        3\nvacc_date_3   vacc_date_3      Date       0      116\nvacc_brand_3 vacc_brand_3   numeric       0        3\n\n$outcome_event\n                           variable     class n_empty n_unique\nid                               id character       0      335\nhosp_id                     hosp_id character       0      100\nprimary_diagnosis primary_diagnosis   integer       0        2\ndiagnosis_date       diagnosis_date      Date       0      354\ndiagnosis_code       diagnosis_code character       0        8\ncoding_system         coding_system character       0        1\nhosp_id_new             hosp_id_new character       0      100\nid_new                       id_new character       0      335\n\n$comorbidity\n                       variable     class n_empty n_unique\nid                           id character       0      237\ndiagnosis_date   diagnosis_date      Date       0      366\ndiagnosis_code   diagnosis_code character       0      101\norigin_of_event origin_of_event    factor       0        2\ncoding_system     coding_system character       0        1\n```\n\n\n:::\n:::\n\n\n\n- Skim the date format:\n\n<!--- Note: Please look at the output of this chunk to check if the format of all the date columns (except the column `birth_date`) is of type \"Date\", formatted as yyyy-mm-dd. --->\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nbirth_date int [1:335] 15 15 15 15 15 15 15 15 15 15 ...\ndeath_date Date[1:335], format: NA NA \"2016-10-11\" \"2015-05-15\" NA NA NA NA NA NA \"2015-10-14\" NA NA ...\nenrol_date Date[1:335], format: NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA ...\nderegister_date Date[1:335], format: NA NA \"2016-10-11\" \"2015-05-15\" NA NA NA NA NA NA \"2015-10-14\" NA NA ...\ninfect_date Date[1:100], format: \"2022-11-20\" \"2021-02-05\" \"2022-09-22\" \"2021-06-26\" \"2022-02-05\" ...\nvacc_date_1 Date[1:301], format: \"2020-02-17\" \"2022-12-16\" \"2022-02-28\" \"2021-12-05\" \"2021-09-15\" ...\nvacc_date_2 Date[1:301], format: \"2021-05-26\" NA \"2022-05-19\" \"2022-04-25\" NA \"2022-05-23\" NA ...\nvacc_date_3 Date[1:301], format: \"2022-02-16\" NA NA \"2022-05-19\" NA \"2022-06-16\" NA \"2022-12-14\" ...\ndiagnosis_date Date[1:437], format: \"2020-11-04\" \"2020-12-22\" \"2020-06-03\" \"2020-11-04\" \"2020-03-01\" ...\ndiagnosis_date Date[1:4478], format: \"2020-09-24\" \"2020-05-19\" \"2020-09-05\" \"2020-07-06\" \"2020-07-20\" ...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$individual\nNULL\n\n$covid_infection\nNULL\n\n$covid_vacc\nNULL\n\n$outcome_event\nNULL\n\n$comorbidity\nNULL\n```\n\n\n:::\n:::\n\n\n\n### Add names of the outcome and covariate\n\n-   Build the reference tables\n\n\n\n::: {.cell}\n\n:::\n\n\n\n-   Adding names of the outcome/ comorbidities based on the reference table\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n\n-   Some sanity check: Any ICDs not classified in outcome and comorb tables? (it should be 0)\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 0 × 2\n# ℹ 2 variables: diagnosis_code <chr>, n <int>\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 0 × 2\n# ℹ 2 variables: diagnosis_code <chr>, n <int>\n```\n\n\n:::\n:::\n\n{{< pagebreak >}}\n\n\n\n\n## 1. Apply eligibility criteria\n\n### Inclusion criteria\n\n-   Age \\>= 12 years\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nAge >= 12yo:  335  individuals\n```\n\n\n:::\n:::\n\n\n\n-   Obs period 1st Oct 2020 - 30 Apr 2022\n\n\n\n::: {.cell}\n\n:::\n\n\n\n-   Apply the inclusion criteria:\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nTotal number of all outcome events in the observation period:  294 , from  212  individuals\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNumber of each outcome before applying exclusion criteria:\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 2\n  event_name         n_event\n  <chr>                <int>\n1 Myocarditis             48\n2 Pulmonary embolism     205\n3 Thrombocytopenia        41\n```\n\n\n:::\n:::\n\n\n\n### Exclusion criteria\n\n#### Missing COVID-19 vacc date, vaccine dose and vaccine brand\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nMissing vaccination info:  0  individuals\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSummary of different types of missing vacc info: \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  incomplete_dose1 incomplete_dose2 incomplete_dose3 dose2_without_dose1\n1                0                0                0                   0\n  dose3_without_dose1_or_2\n1                        0\n```\n\n\n:::\n:::\n\n\n\n#### Heterologious dose (For BNT & ChAd only)\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nHeterologious dose 1 and 2:  36  individuals\n```\n\n\n:::\n:::\n\n\n\n#### Missing COVID-19 infection date\n\n\n\n::: {.cell}\n\n:::\n\n\n\n#### Individuals with \\<3 years of data availability prior to 1st Oct 2020\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nIndividuals with <3 years of data availability prior to 1st Oct 2020  0  individuals\n```\n\n\n:::\n:::\n\n\n\n-   Apply the general exclusion criteria to all tables\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nGenerally excluded individuals:  36\n```\n\n\n:::\n:::\n\n\n\n### Specific exclusion criteria to each outcome\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nNumber of events per outcome before applying outcome-specific exclusion:\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 2\n  event_name         n_event\n  <chr>                <int>\n1 Myocarditis             41\n2 Pulmonary embolism     168\n3 Thrombocytopenia        30\n```\n\n\n:::\n:::\n\n\n\n#### Inpatient diagnosis of the outcome between 1st October 2017 and 30th September 2020\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nPrior MYO:  2  individuals\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPrior PE:  12  individuals\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPrior THRC:  6  individuals\n```\n\n\n:::\n:::\n\n\n\n#### Only keep the first event (for each outcome) per individual\n\n\n\n::: {.cell}\n\n:::\n\n\n\n-   Keep only individuals with events after applying exclusion criteria\n\n\n\n::: {.cell}\n\n:::\n\n\n\n#### Number of events per outcome after applying all eligibility criteria (and before censoring):\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 1\n  n_myo\n  <int>\n1    33\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 1\n   n_pe\n  <int>\n1   127\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 1\n  n_thrc\n   <int>\n1     22\n```\n\n\n:::\n:::\n\n{{< pagebreak >}}\n\n\n\n\n## 2. Apply censoring information\n\n### 1st dose of COVID-19 vaccine other than BNT-162b2 or ChAdOx1\n\n\n\n::: {.cell}\n\n:::\n\n\n\n### 3rd dose of BNT-162b2 or ChAdOx1\n\n\n\n::: {.cell}\n\n:::\n\n\n\n### 1st COVID-19 infection\n\n\n\n::: {.cell}\n\n:::\n\n\n\n### Merge information to table `individual` and pick the earliest date before 30 Apr 2022 as censoring date\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n\n### Retain only the outcomes during the observation period of each individual\n\n\n\n::: {.cell}\n\n:::\n\n\n\n-   Number of events per outcome after censoring:\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 1\n  n_myo\n  <int>\n1    16\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 1\n   n_pe\n  <int>\n1    62\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 1\n  n_thrc\n   <int>\n1      9\n```\n\n\n:::\n:::\n\n\n\n## 4. Reshape data for analysis\n\n### Build SCCS data\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n\n<!-- Note: If the above messages were actually printed, please inspect the data before continue with the workflow  -->\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n\n### Determine comorbidities status\n\n\n\n::: {.cell}\n\n:::\n\n\n\n### Final data for analysis\n\n\n\n::: {.cell}\n\n:::\n\n\n\n-   Skim the final datasets:\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n$myo_sccs\n      id            primary_diagnosis diagnosis_date       diagnosis_code    \n Length:16          Min.   :0.0       Min.   :2020-11-13   Length:16         \n Class :character   1st Qu.:0.0       1st Qu.:2021-02-17   Class :character  \n Mode  :character   Median :0.5       Median :2021-05-05   Mode  :character  \n                    Mean   :0.5       Mean   :2021-06-24                     \n                    3rd Qu.:1.0       3rd Qu.:2021-12-04                     \n                    Max.   :1.0       Max.   :2022-03-13                     \n                                                                             \n hosp_id_new           id_new            event_id          event_name       \n Length:16          Length:16          Length:16          Length:16         \n Class :character   Class :character   Class :character   Class :character  \n Mode  :character   Mode  :character   Mode  :character   Mode  :character  \n                                                                            \n                                                                            \n                                                                            \n                                                                            \n  obs_end_date         obs_sta_date          bnt_1_date        \n Min.   :2021-08-21   Min.   :2020-10-01   Min.   :2020-02-17  \n 1st Qu.:2022-02-14   1st Qu.:2020-10-01   1st Qu.:2021-01-19  \n Median :2022-04-30   Median :2020-10-01   Median :2021-04-19  \n Mean   :2022-03-11   Mean   :2020-10-01   Mean   :2021-04-26  \n 3rd Qu.:2022-04-30   3rd Qu.:2020-10-01   3rd Qu.:2021-11-28  \n Max.   :2022-04-30   Max.   :2020-10-01   Max.   :2022-02-27  \n                                           NA's   :8           \n   bnt_2_date          chad_1_date          chad_2_date            obs_sta \n Min.   :2021-05-26   Min.   :2020-11-13   Min.   :2022-04-01   Min.   :1  \n 1st Qu.:2021-07-26   1st Qu.:2021-01-12   1st Qu.:2022-05-05   1st Qu.:1  \n Median :2022-08-05   Median :2021-03-13   Median :2022-06-09   Median :1  \n Mean   :2022-04-11   Mean   :2021-06-06   Mean   :2022-06-09   Mean   :1  \n 3rd Qu.:2022-09-13   3rd Qu.:2021-09-16   3rd Qu.:2022-07-13   3rd Qu.:1  \n Max.   :2022-12-10   Max.   :2022-03-23   Max.   :2022-08-17   Max.   :1  \n NA's   :7            NA's   :13           NA's   :14                      \n    obs_end          bnt_1            bnt_2           chad_1     \n Min.   :325.0   Min.   :-226.0   Min.   :238.0   Min.   : 44.0  \n 1st Qu.:502.5   1st Qu.: 111.5   1st Qu.:299.0   1st Qu.:104.0  \n Median :577.0   Median : 201.5   Median :674.0   Median :164.0  \n Mean   :527.5   Mean   : 208.9   Mean   :558.8   Mean   :249.0  \n 3rd Qu.:577.0   3rd Qu.: 424.8   3rd Qu.:713.0   3rd Qu.:351.5  \n Max.   :577.0   Max.   : 515.0   Max.   :801.0   Max.   :539.0  \n                 NA's   :8        NA's   :7       NA's   :13     \n     chad_2        diagnosis    \n Min.   :548.0   Min.   : 44.0  \n 1st Qu.:582.5   1st Qu.:140.8  \n Median :617.0   Median :217.0  \n Mean   :617.0   Mean   :267.2  \n 3rd Qu.:651.5   3rd Qu.:430.8  \n Max.   :686.0   Max.   :529.0  \n NA's   :14                     \n\n$pe_sccs\n      id            primary_diagnosis diagnosis_date       diagnosis_code    \n Length:62          Min.   :0.0000    Min.   :2020-10-04   Length:62         \n Class :character   1st Qu.:0.0000    1st Qu.:2021-04-04   Class :character  \n Mode  :character   Median :1.0000    Median :2021-09-02   Mode  :character  \n                    Mean   :0.7258    Mean   :2021-07-31                     \n                    3rd Qu.:1.0000    3rd Qu.:2021-12-08                     \n                    Max.   :1.0000    Max.   :2022-04-27                     \n                                                                             \n hosp_id_new           id_new            event_id          event_name       \n Length:62          Length:62          Length:62          Length:62         \n Class :character   Class :character   Class :character   Class :character  \n Mode  :character   Mode  :character   Mode  :character   Mode  :character  \n                                                                            \n                                                                            \n                                                                            \n                                                                            \n  obs_end_date         obs_sta_date          bnt_1_date        \n Min.   :2021-04-17   Min.   :2020-10-01   Min.   :2020-01-27  \n 1st Qu.:2022-04-30   1st Qu.:2020-10-01   1st Qu.:2020-08-15  \n Median :2022-04-30   Median :2020-10-01   Median :2021-01-24  \n Mean   :2022-03-30   Mean   :2020-10-01   Mean   :2021-03-23  \n 3rd Qu.:2022-04-30   3rd Qu.:2020-10-01   3rd Qu.:2021-09-30  \n Max.   :2022-04-30   Max.   :2020-10-01   Max.   :2022-12-04  \n                                           NA's   :38          \n   bnt_2_date          chad_1_date          chad_2_date            obs_sta \n Min.   :2020-07-23   Min.   :2020-03-29   Min.   :2021-05-24   Min.   :1  \n 1st Qu.:2021-11-29   1st Qu.:2020-10-14   1st Qu.:2022-04-14   1st Qu.:1  \n Median :2022-06-30   Median :2021-05-17   Median :2022-09-04   Median :1  \n Mean   :2022-04-15   Mean   :2021-08-11   Mean   :2022-06-26   Mean   :1  \n 3rd Qu.:2022-11-03   3rd Qu.:2022-08-12   3rd Qu.:2022-11-12   3rd Qu.:1  \n Max.   :2022-12-31   Max.   :2022-12-13   Max.   :2022-12-29   Max.   :1  \n NA's   :41           NA's   :46           NA's   :48                      \n    obs_end          bnt_1             bnt_2           chad_1       \n Min.   :199.0   Min.   :-247.00   Min.   :-69.0   Min.   :-185.00  \n 1st Qu.:577.0   1st Qu.: -45.25   1st Qu.:425.0   1st Qu.:  14.25  \n Median :577.0   Median : 116.50   Median :638.0   Median : 229.50  \n Mean   :546.5   Mean   : 174.42   Mean   :562.6   Mean   : 315.06  \n 3rd Qu.:577.0   3rd Qu.: 365.75   3rd Qu.:764.0   3rd Qu.: 681.00  \n Max.   :577.0   Max.   : 795.00   Max.   :822.0   Max.   : 804.00  \n                 NA's   :38        NA's   :41      NA's   :46       \n     chad_2        diagnosis    \n Min.   :236.0   Min.   :  4.0  \n 1st Qu.:561.0   1st Qu.:186.2  \n Median :704.5   Median :337.5  \n Mean   :634.5   Mean   :304.9  \n 3rd Qu.:773.8   3rd Qu.:434.8  \n Max.   :820.0   Max.   :574.0  \n NA's   :48                     \n\n$thrc_sccs\n      id            primary_diagnosis diagnosis_date       diagnosis_code    \n Length:9           Min.   :1         Min.   :2020-12-27   Length:9          \n Class :character   1st Qu.:1         1st Qu.:2021-05-11   Class :character  \n Mode  :character   Median :1         Median :2021-06-30   Mode  :character  \n                    Mean   :1         Mean   :2021-07-19                     \n                    3rd Qu.:1         3rd Qu.:2021-11-17                     \n                    Max.   :1         Max.   :2022-04-20                     \n                                                                             \n hosp_id_new           id_new            event_id          event_name       \n Length:9           Length:9           Length:9           Length:9          \n Class :character   Class :character   Class :character   Class :character  \n Mode  :character   Mode  :character   Mode  :character   Mode  :character  \n                                                                            \n                                                                            \n                                                                            \n                                                                            \n  obs_end_date         obs_sta_date          bnt_1_date        \n Min.   :2021-11-19   Min.   :2020-10-01   Min.   :2022-04-21  \n 1st Qu.:2022-04-30   1st Qu.:2020-10-01   1st Qu.:2022-04-27  \n Median :2022-04-30   Median :2020-10-01   Median :2022-05-04  \n Mean   :2022-04-12   Mean   :2020-10-01   Mean   :2022-05-04  \n 3rd Qu.:2022-04-30   3rd Qu.:2020-10-01   3rd Qu.:2022-05-11  \n Max.   :2022-04-30   Max.   :2020-10-01   Max.   :2022-05-18  \n                                           NA's   :7           \n   bnt_2_date          chad_1_date          chad_2_date            obs_sta \n Min.   :2022-12-01   Min.   :2020-03-29   Min.   :2022-04-05   Min.   :1  \n 1st Qu.:2022-12-01   1st Qu.:2020-10-07   1st Qu.:2022-05-17   1st Qu.:1  \n Median :2022-12-02   Median :2021-04-17   Median :2022-06-29   Median :1  \n Mean   :2022-12-02   Mean   :2021-04-17   Mean   :2022-06-29   Mean   :1  \n 3rd Qu.:2022-12-02   3rd Qu.:2021-10-26   3rd Qu.:2022-08-10   3rd Qu.:1  \n Max.   :2022-12-03   Max.   :2022-05-06   Max.   :2022-09-22   Max.   :1  \n NA's   :7            NA's   :7            NA's   :7                       \n    obs_end        bnt_1           bnt_2           chad_1         chad_2     \n Min.   :415   Min.   :568.0   Min.   :792.0   Min.   :-185   Min.   :552.0  \n 1st Qu.:577   1st Qu.:574.8   1st Qu.:792.5   1st Qu.:   7   1st Qu.:594.5  \n Median :577   Median :581.5   Median :793.0   Median : 199   Median :637.0  \n Mean   :559   Mean   :581.5   Mean   :793.0   Mean   : 199   Mean   :637.0  \n 3rd Qu.:577   3rd Qu.:588.2   3rd Qu.:793.5   3rd Qu.: 391   3rd Qu.:679.5  \n Max.   :577   Max.   :595.0   Max.   :794.0   Max.   : 583   Max.   :722.0  \n               NA's   :7       NA's   :7       NA's   :7      NA's   :7      \n   diagnosis    \n Min.   : 88.0  \n 1st Qu.:223.0  \n Median :273.0  \n Mean   :292.3  \n 3rd Qu.:413.0  \n Max.   :567.0  \n                \n\n$comorb_stat\n      id             lung_disease         ckd             diabetes     \n Length:166         Min.   :0.0000   Min.   :0.00000   Min.   :0.0000  \n Class :character   1st Qu.:0.0000   1st Qu.:0.00000   1st Qu.:0.0000  \n Mode  :character   Median :0.0000   Median :0.00000   Median :0.0000  \n                    Mean   :0.2169   Mean   :0.07229   Mean   :0.2169  \n                    3rd Qu.:0.0000   3rd Qu.:0.00000   3rd Qu.:0.0000  \n                    Max.   :1.0000   Max.   :1.00000   Max.   :1.0000  \n      cvd            cancer      \n Min.   :0.000   Min.   :0.0000  \n 1st Qu.:0.000   1st Qu.:0.0000  \n Median :1.000   Median :0.0000  \n Mean   :0.512   Mean   :0.1205  \n 3rd Qu.:1.000   3rd Qu.:0.0000  \n Max.   :1.000   Max.   :1.0000  \n\n$individual\n      id              birth_date  birth_month       birth_year        sex    \n Length:166         Min.   :15   Min.   : 1.000   Min.   :1914   Male   :81  \n Class :character   1st Qu.:15   1st Qu.: 4.000   1st Qu.:1931   Female :85  \n Mode  :character   Median :15   Median : 6.000   Median :1942   Unknown: 0  \n                    Mean   :15   Mean   : 6.512   Mean   :1947               \n                    3rd Qu.:15   3rd Qu.:10.000   3rd Qu.:1960               \n                    Max.   :15   Max.   :12.000   Max.   :1997               \n                                                                             \n   death_date           enrol_date  deregister_date           age        \n Min.   :2015-03-07   Min.   :NA    Min.   :2015-03-07   Min.   : 23.00  \n 1st Qu.:2016-02-26   1st Qu.:NA    1st Qu.:2016-02-26   1st Qu.: 60.00  \n Median :2016-12-14   Median :NA    Median :2016-12-14   Median : 78.00  \n Mean   :2016-12-31   Mean   :NaN   Mean   :2016-12-31   Mean   : 72.96  \n 3rd Qu.:2017-12-10   3rd Qu.:NA    3rd Qu.:2017-12-10   3rd Qu.: 89.00  \n Max.   :2018-11-09   Max.   :NA    Max.   :2018-11-09   Max.   :106.00  \n NA's   :127          NA's   :166   NA's   :127                          \n   admin_end           vacc_date_1          vacc_date_3        \n Min.   :2022-04-30   Min.   :2020-01-04   Min.   :2021-03-17  \n 1st Qu.:2022-04-30   1st Qu.:2020-08-02   1st Qu.:2022-06-20  \n Median :2022-04-30   Median :2021-07-03   Median :2022-11-06  \n Mean   :2022-04-30   Mean   :2021-05-12   Mean   :2022-09-01  \n 3rd Qu.:2022-04-30   3rd Qu.:2021-10-27   3rd Qu.:2022-12-10  \n Max.   :2022-04-30   Max.   :2022-12-12   Max.   :2022-12-31  \n                      NA's   :106          NA's   :80          \n  infect_date          obs_sta_date         obs_end_date       \n Min.   :2020-03-12   Min.   :2020-10-01   Min.   :2015-03-06  \n 1st Qu.:2020-06-30   1st Qu.:2020-10-01   1st Qu.:2020-02-14  \n Median :2021-03-31   Median :2020-10-01   Median :2021-09-22  \n Mean   :2021-04-03   Mean   :2020-10-01   Mean   :2020-08-23  \n 3rd Qu.:2021-10-29   3rd Qu.:2020-10-01   3rd Qu.:2022-04-30  \n Max.   :2022-11-20   Max.   :2020-10-01   Max.   :2022-04-30  \n NA's   :127                                                   \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$myo_sccs\n                           variable     class n_empty n_unique\nid                               id character       0       16\nprimary_diagnosis primary_diagnosis   integer       0        2\ndiagnosis_date       diagnosis_date      Date       0       16\ndiagnosis_code       diagnosis_code character       0        2\nhosp_id_new             hosp_id_new character       0       12\nid_new                       id_new character       0       16\nevent_id                   event_id character       0        1\nevent_name               event_name character       0        1\nobs_end_date           obs_end_date      Date       0        7\nobs_sta_date           obs_sta_date      Date       0        1\nbnt_1_date               bnt_1_date      Date       0        8\nbnt_2_date               bnt_2_date      Date       0        9\nchad_1_date             chad_1_date      Date       0        3\nchad_2_date             chad_2_date      Date       0        2\nobs_sta                     obs_sta   numeric       0        1\nobs_end                     obs_end   numeric       0        7\nbnt_1                         bnt_1   numeric       0        8\nbnt_2                         bnt_2   numeric       0        9\nchad_1                       chad_1   numeric       0        3\nchad_2                       chad_2   numeric       0        2\ndiagnosis                 diagnosis   numeric       0       16\n\n$comorb_stat\n                 variable     class n_empty n_unique\nid                     id character       0      166\nlung_disease lung_disease   numeric       0        2\nckd                   ckd   numeric       0        2\ndiabetes         diabetes   numeric       0        2\ncvd                   cvd   numeric       0        2\ncancer             cancer   numeric       0        2\n\n$individual\n                       variable     class n_empty n_unique\nid                           id character       0      166\nbirth_date           birth_date   integer       0        1\nbirth_month         birth_month   integer       0       12\nbirth_year           birth_year   integer       0       69\nsex                         sex    factor       0        2\ndeath_date           death_date      Date       0       38\nenrol_date           enrol_date      Date       0        0\nderegister_date deregister_date      Date       0       38\nage                         age   numeric       0       69\nadmin_end             admin_end      Date       0        1\nvacc_date_1         vacc_date_1      Date       0       58\nvacc_date_3         vacc_date_3      Date       0       72\ninfect_date         infect_date      Date       0       39\nobs_sta_date       obs_sta_date      Date       0        1\nobs_end_date       obs_end_date      Date       0       99\n```\n\n\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}